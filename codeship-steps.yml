- service: stack
  tag: ^$
  command: /bin/true

- type: serial
  tag: ^[^_]
  encrypted_dockercfg_path: dockercfg.encrypted
  steps:
    - service: cache
      command: &IMAGE cjengineering/haskell-stack
    - type: serial
      registry: &REGISTRY https://index.docker.io/v1/
      service: stack
      image_name: *IMAGE
      steps:
      - type: push
        tag: master
        image_tag: latest
      - type: push
        tag: master
        image_tag: "commit-{{.CommitID}}"
      - type: push
        image_tag: "branch-{{.Branch}}"
