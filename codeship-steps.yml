- service: stack
  tag: ^$
  command: /bin/true

- type: serial
  tag: ^[^_]
  encrypted_dockercfg_path: dockercfg.encrypted
  steps:
    - service: cache
      command: &IMAGE cjengineering/haskell-stack
    - type: push
      service: stack
      tag: master
      registry: &REGISTRY https://index.docker.io/v1/
      command: &IMAGE cjengineering/haskell-stack
      image_tag: latest
    - type: push
      service: stack
      tag: master
      registry: *REGISTRY
      image_name: *IMAGE
      image_tag: "commit-{{.CommitID}}"
    - type: push
      service: stack
      registry: *REGISTRY
      image_name: *IMAGE
      image_tag: "branch-{{.Branch}}"

